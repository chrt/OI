---
title: "[OEIS A001499] 每行每列恰有两个1的n*n 0-1矩阵数"
date: 2017-06-18 23:29:47
categories:
- OEIS
tags:
- 数学
- 排列组合
- 递推
---
求每行每列恰有两个1的n\*n 0-1矩阵的数目. 输出前缀和对998244353取模的结果.
<!--more-->
这是雅礼模拟考试的一道题 (by Owaski).

首先, 单次 $O(n^3)$ 的DP很容易. 一行一行考虑, 每行放两个1, 记录当前多少列有一个1, 多少列没有1. 写个记忆化搜索. 常数很小.

设当前在第 $i$ 行, $j$ 列有一个1. 可以对列数之和, 1的数目之和列方程, 每种列有多少个直接解出来......或者直接yy......这样就是单次 $O(n^2)$ 了.

题目求的是前缀和. 用上面的状态, 每次得重新算. 考虑直接以 $n$ 为状态, 设 $f_n$ 为答案.

把 $a_{i,j} = 1$ 看成第 $i$ 行到第 $j$ 列的二分图 (多重) 匹配, 则所求的是完美匹配的数量.

这个二分图由一个个分离的环组成, 并且每个环左部,右部包含的点数相同. 不妨枚举1号点所在的环的大小/2, 再枚举这个环中有哪些点, 剩余的点集便是一个子问题
$$
f_n = \sum_{i=2}^n \binom {n-1} {i-1} \binom n i A_n f_{n-i}
$$

其中 $A_n$ 是左右部各有 $n$ 个点的完全二分图的生成环 (这个词是我造的......类比生成树) 的数目. 不妨把环先看成有向的, 以左部的1号点为起点, 那么, 一个环对应 (n-1的某排列, n的某排列). 由于顺逆时针各算了一次, 所以
$$
A_n = \frac {n!(n-1)!} 2
$$

代入化简, 最终可以 $O(n)$ 解决整个问题.

OEIS上给出了这样一个神奇的递推式 (考试的时候有大爷*感受了一下*, 用高斯消元消出来了......)
$$
a(0) = 1, a(1) = 0\\\\
a(n) = (n^2-n)(a(n-1)+(n-1)/2 \cdot a(n-2)) (n > 1)
$$

感谢[坐我右边的右边的大爷](http://www.cnblogs.com/galaxies/)教我推这个式子. >_<

设 $F_{i,j}$ 为左部 $i$ 个点, 右部 $j$ 个点, 每个点度数为2的二分图的数目, $G_{i,j}$ 为左 $i$ 右 $j$, 右部有且仅有两个点度数为1, 其余点度数为2的二分图的数目. 我们求的是 $F_{n,n}$.

考虑 $F$ 中左部的1号点和右部的哪两个点连边, 右部的1号点和左部的哪两个点连边, 发现下述一一对应关系:
$$
F_{i,j} = G_{i-1,j} = G_{j-1,i}
$$

再来建立 $G$ 的递推关系. 右部中那两个度数为1的点有两种情况:
- 它们和左部的同一个点相连. $\binom i 1\binom j 2 F_{i-1,j-2}$. 这是多对一的映射, 所以要乘上组合数.
- 它们和左部的两个不同点相连. 把右部这两个点去掉, 左部出现两个度数为1的点. $P_j^2 G_{j-2,i}$. 因为 $G$ 中已经包含两个度数为1的点的位置的所有情况, 所以不用乘上其他东西. 注意这里是排列数.

化简可得
$$
F_{i+1,j} = \binom i 1\binom j 2 F_{i-1,j-2} + P_j^2 F_{i,j-1}
$$

令 $j = i+1$, 化简后便得到了OEIS上的有趣二阶递推式.

启发:
1. 我联想到了 [[bzoj 1059] [ZJOI2007]矩阵游戏](/2017/05/31/bzoj1059-matrix-game/), 却没有从0-1矩阵和二分图匹配的对应关系中找到灵感......
2. 抽象成熟悉的模型.
3. 计数问题中的递推关系, 关键是要抓住对应关系.