---
title: "[雅礼1706 Day 4] QYH"
date: 2017-07-02 14:50:27
categories:
- other
tags:
- 决策单调性
- 单调栈
- 分治
---
n 个开区间, 从中选 m (m > 1) 个, 它们的权值为 |交| \* |并|. 求最大权值. (1 &le; n &le; 10^6, 1 &le; l &lt; r &le; 10^6)
[[bzoj 2687] 交与并](http://www.lydsy.com/JudgeOnline/problem.php?id=2687)
<!--more-->
题面没写 "数据有一定梯度", 我还以为不是10分, 就是100分......

首先, 如果A包含于B, 那么用B替换A, 答案不会变差. 但是有一种情况, A是不能被替换为B的: 只选择A和B. 那么, 对于所有区间, 找出包含它的最长区间. 如果存在, 更新答案 (即 $|A||B|$), 扔掉它.

按左端点排序; 左端点相同, 长度大的放前面. 用区间长度更新右端点位置的权值, 那么待查询的是后缀最大值, 用树状数组维护.

处理完之后, 区间左右端点均非严格递增. 发现, 选择 $A_i,A_j,A_k (i < j < k)$ 和只选 $A_i,A_k$, 权值是相等的. 所以, 问题简化为, 寻找两个区间 $(l_i,r_i), (l_j,r_j) (i < j)$, 使得 $f(j,i) = (r_j-l_i)(r_i-l_j)$ 最大.

对于一个 $A_k$, 考察决策 $A_j$ 优于 $A_i$ 的条件 $(i < j < k)$:
$$
f(k,j)-f(k,i) = r_k(r_j-r_i) + l_k(l_j-l_i) - l_jr_j + l_ir_i
$$

由于左右端点均非严格递增, 一旦对于某个 $k$, 有 $f(k,j) \ge f(k,i)$, 那么对于 $k' > k$, 同样有 $f(k',j) \ge f(k',i)$. (反之不然)

称使 $f(k,x)$ 最大的 $x$ 为 $k$ 的决策点 $p(k)$ (若有多个, 取最靠左的), 则 $p(k') \ge p(k)$. 以前 $p(k)$ 优于左边的点, 现在仍然如此.

有了决策单调性, 我们知道决策表长这样: 111 222 33333 4 555

接下来有两种方案:
- **单调栈** 决策表每一段是单调栈中的一个节点. 每计算出一个新的值, 用它更新决策表. 如果可以整段替换, 就弹栈. 否则, 在这一段内二分, 分裂这个节点.
- **分治** 定义 $solve(l,r,x,y)$ 求解 $[l,r]$ 的答案, 已知这一段的决策点在 $[x,y]$ 中. 令 $m = \lfloor (l+r)/2 \rfloor$. 把 $[x,y]\cap [1,m)$ 扫一遍, 求 $p(m)$. 然后递归下去: $solve(l,m-1,x,p(m)), solve(m+1,r,p(m),y)$.

时间复杂度都是 $O(n\lg n)$, 个人喜欢分治~

听了三位神犇讲这题, 每人讲了至少两遍, 终于产生了一点明白的感觉......非常感谢 ＞﹏＜
